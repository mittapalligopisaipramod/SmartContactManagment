<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Contact Managment</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    <link rel="icon" href="/image.png">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <style>
        body, html {
            height: 100%;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .car {
            border-style: solid;
            border-radius: 8px;
            border-width: 0px;
            text-align: center;
            text-align: center;
            margin: auto;
            padding: 20px;
        }
        .bg {
            background-color: red;
            height: 200px;
        }
        .home{
            display: flex;
            justify-content: space-between;
            padding: 10px;
        }
        .container{
            display: flex;
            justify-content: space-between;
        }
        .body {
            display: flex;
            align-items: flex-start;
            width: 100vw;
            margin: 0;
            font-family: Arial, sans-serif;
            overflow-x: hidden;
        }
        .container {
            display: flex;
            width: 100%;
            height: 100%;
        }
        .left-half, .right-half {
            flex: 1;
            padding: 20px;
            box-sizing: border-box;
        }
        .right-half {
            overflow-y: auto;
        }
        .nav{
            background-color: #1c67e7;
            padding: 10px;
            width: 100vw;
            margin: 0;
            display: flex;
            justify-content: center;
        }
        .card {
            background-color: #f0f0f0;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        .btn {
            cursor: pointer;
            padding: 5px 10px;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 3px;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        #sectionHome{
            display: none;
            align-items: flex-start;
            justify-content: flex-start;
            margin: 0;
        }
        .logbtn{
            align-self: center;
        }
        a{
            cursor: pointer;
        }
    </style>
</head>
<body>

<!-- <div class='car shadow' id='sectionLogin'>
    <p id='done'> </p>
    <h1> Login </h1>
    <div>
        <input type='text' placeholder='Enter your name' id='name' /><br />
        <br />
        <input type='text' placeholder='Enter your password' id='password' />
        <div class='mt-2'>
            <button class='btn btn-primary' id='signUp'> SignUp </button>
            <button class='btn btn-primary' id='signIn'> SignIn </button>
        </div>
    </div>
</div> -->

<div class="d-flex flex-column justify-content-center mt-2">
    <div class='car shadow' id='sectionSignIn'>
        <p id="successLogin"></p>
        <h1> Login </h1>
        <table>
            <tr>
                <td><label for='namelog'>Email</label></td>
                <td><input type='text' id='namelog' class='input' /></td>
            </tr>
            <tr>
                <td><label for='passwordlog'>Password</label></td>
                <td><input type='password' id='passwordlog' class='input2' /></td>
            </tr>
            <tr>
                <td colspan="2">
                    <div>
                        <button class='btn btn-primary mt-2' id='btnlog'> Login In </button>
                        <button class="bnt btn-primary d-none" onclick="display('sectionHome')" id="HomePagemove"> Home Page </button>
                        <button id="signUp" onclick="display('sectionEmail')" class="btn btn-primary"> SignUp </button>
                        <a onclick="display('sectionEmailVerificationPassword')" style="color:blue; font-decoration:underline;"> Forget Password </a>
                    </div>
                </td>
            </tr>
        </table>
    </div>
</div>

<div id="sectionEmailVerificationPassword" class="car shadow">
    <p id="emailPasswordSent"></p>
    <div class="spinner-border d-none" role="status" id="status2">
        <span class="sr-only">Loading...</span>
    </div>
    <h1> Verify your Email </h1>
    <div>
        <p> Enter your Email </p>
        <input type='email' id='vemail2' required='required' />
        <p id='errorverified2'></p>
        <br />
        <div>
            <button class='btn btn-primary' id='btnverify2'> Click Here </button>
            <button class="btn btn-primary d-none" onclick="display('sectionOTP2')" id="gotootp"> Click to go Otp </button>
        </div>
    </div>
</div>

<div id="sectionOTP2" class="car shadow">
    <p id="otp2information"></p>
    <h1> Enter OTP here! </h1>
    <div>
        <input type='text' id='otp2'/>
        <p id='otperror2'></p>

        <div>
            <button class='btn btn-primary' id='btnotp2'> Verify </button>
            <button class="btn btn-primary d-none" onclick="display('sectionNewPassword')" id="btnNewPassword"> Password Reset </button>
    </div>
</div>
</div>

<div id='sectionEmail' class='car shadow'>
    <p id="emailSent"></p>
    <div class="spinner-border d-none" role="status" id="status">
        <span class="sr-only">Loading...</span>
    </div>
    <h1> Verify your Email </h1>
    <div>
        <p> Enter your Email </p>
        <input type='email' id='vemail' required='required'/>
        <p id='errorverified'></p>
        <br />
        <div>
            <button class='btn btn-primary' id='btnverify'> Click Here </button>
            <button class="btn btn-primary d-none" onclick="display('sectionOTP')" id="btnmove"> OTP Section </button>
        </div>
    </div>
</div>
<div id='sectionOTP' class='car shadow'>
    <p id="otpSent"></p>
    <h1> Enter OTP here! </h1>
    <div>
        <input type='text' id='otp'/>
        <p id='otperror'></p>

        <div>
            <button class='btn btn-primary' id='btnotp'> Verify </button>
            <button class="btn btn-success d-none" onclick="display('sectionSignUp')" id="movesignUp"> Move to SignUp </button>
            <button class='btn btn-primary' id='btnresend'> Resend again </button>
        </div>
    </div>
</div>

    <div id="sectionNewPassword" class="car shadow">
        <p id="passwordchangeinformation"></p>
        <table>
            <p id="errorMessagePasswordUPdate"></p>
            <tr>
                <td><label for='fullName'>New Password</label></td>
                <td><input type='password' id='newPassword' class='input' /></td>
            </tr>
            <tr>
                <td><label for='userName'>Conform Password</label></td>
                <td><input type='password' id='conformPassword' class='input' /></td>
            </tr>
            <tr>
                <td colspan="2" style="text-align:center;">
                    <button class='btn btn-primary mt-2' id='passwordUpdatebtn'> Update Password </button>
                    <button class="btn btn-primary d-none" onclick="display('sectionSignIn')" id="movetologinagain"> Click Again </button>
                </td>
            </tr>
        </table>
    </div>
<div class='car shadow' id='sectionSignUp'>
    <h1> Sign Up </h1>
    <table>
        <tr>
            <td> <label> Upload Image </label> </td>
            <td> <input type="file" id="imageUpload" accept="image/*"> </td>
            <td> <img src="" id="uploadImage"/> </td>
        </tr>
        <tr>
            <td><label for='fullName'>Name</label></td>
            <td><input type='text' id='fullName' class='input' /></td>
        </tr>
        <tr>
            <td><label for='userName'>Email</label></td>
            <td><input type='email' id='userName' class='input' /></td>
        </tr>
        <tr>
            <td><label for='password11'>Password</label></td>
            <td><input type='password' id='password11' class='input2' /></td>
        </tr>
        <tr>
            <td colspan="2" style="text-align:center;">
                <button class='btn btn-primary mt-2' id='regi'> Register Here </button>
                <button class='btn btn-primary mt-2 d-none' id='log' onclick="display('sectionSignIn')"> Login In </button>
            </td>
        </tr>
    </table>
    <p id='successregi'></p>
</div>

<div id='sectionHome' class="bg-light shadow p-2">
    <div>
        <div class="proUser">
            <img src="" id="userImageNew"/>
            <label id="nameHome">  </label>
        </div>
        <div class="home">
            <button class="btn btn-primary" onclick="display('sectionFormcontainer')" id="contactPageRedirect"> Got to Contact Page </button>
        </div>
    </div>
</div>
<div id="sectionFormcontainer" class="container body">
    <div class="nav">
        <div> <button id="logout" onclick="display('sectionSignIn')" class="logbtn mr-2"> Logout </button> </div>
        <div>
            <div> <img src="" id="userImageNav"/> </div>
            <p id="userNameNew"> </p>
        </div>
    </div>
        <div class="left-half">
            <!-- <div id="list"></div> -->
            <button id="btnAddContact" class="btn"> Add Contact </button>
        </div>
        <div class="right-half">
            <h2>Contact List</h2>
            <table id="contactTable">
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Number</th>
                    <th>Update</th>
                    <th>Delete</th>
                </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
            <p id="response"></p>
        </div>
    </div>

    <!-- <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script> -->
<script>
        //localStorage.removeItem('token');
        let count=0;
        let signUpId = document.getElementById('signUp');
        let signInId = document.getElementById('signIn');
        // signUpId.addEventListener('click', function() {
        //     signUpId.setAttribute('onclick', "display('sectionEmail')");
        // });
        let objresponse=[];
        let vemailId = document.getElementById('vemail');
        let btnverifyId = document.getElementById('btnverify');
        btnverifyId.addEventListener('click', function() {
            //console.log(vemailId.value);
            if(count===0){
                if (vemailId.value !== '') {
                    document.getElementById('emailSent').textContent='wait for few seconds...';
                    document.getElementById('status').classList.remove('d-none');
                    console.log(vemailId.value);
                    //let url = 'http://localhost:8443/sendEmail';
                    let url = 'https://localhost:8443/mail/sendEmail';
                    let option = {
                        method: 'POST',
                        headers: {
                            'Content-Type':'application/json'
                        },
                        body: JSON.stringify({
                            "email": vemailId.value
                        })
                    };
                    fetch(url, option)
                        .then(function(response) {
                            return response.json();
                        })
                        .then(function(jsonData) {
                            if (jsonData) {
                                document.getElementById('status').classList.add('d-none');
                                document.getElementById('btnmove').classList.remove('d-none');
                                btnverifyId.classList.add('d-none');
                                document.getElementById('emailSent').textContent='Otp sent to Email';
                                ++count;
                                //btnverifyId.setAttribute('onclick', "display('sectionOTP')");
                                objresponse.push(jsonData);
                                console.log("ok");
                                //document.getElementById('success').textContent = 'Enter your OTP';
                            } else {
                                vemailId.value = '';
                                document.getElementById('errorverified').textContent = 'Verifiey your email once!';
                                document.getElementById('errorverified').style.color = 'red';
                            }
                        });
                }
            }
        });

        let userEmailEnter=null;
        let vemailId2 = document.getElementById('vemail2');
        let btnverifyId2 = document.getElementById('btnverify2');
        btnverifyId2.addEventListener('click', function() {
            //console.log(vemailId.value);
            document.getElementById('emailPasswordSent').textContent='Wait for few seconds...';
            document.getElementById('status2').classList.remove('d-none');
            if(true){
                if (true) {
                    console.log(vemailId2.value);
                    userEmailEnter=vemailId2.value;
                    //let url = 'http://localhost:8443/sendEmail';
                    let url = 'https://localhost:8443/user/changePassword/sendOtp/toMail';
                    let option = {
                        method: 'POST',
                        headers: {
                            'Content-Type':'application/json'
                        },
                        body: JSON.stringify({
                            "mail": vemailId2.value
                        })
                    };
                    fetch(url, option)
                        .then(function(response) {
                            return response.json();
                        })
                        .then(function(jsonData) {
                            if (jsonData) {
                                document.getElementById('emailPasswordSent').textContent='Otp sent to your email';
                                document.getElementById('gotootp').classList.remove('d-none');
                                document.getElementById('status2').classList.add('d-none');
                                btnverifyId2.classList.add('d-none');
                                ++count;
                                //btnverifyId2.setAttribute('onclick', "display('sectionOTP2')");
                                objresponse.push(jsonData);
                                console.log("ok")
                                //document.getElementById('success').textContent = 'Enter your OTP';
                            } else {
                                vemailId.value = '';
                                document.getElementById('errorverified2').textContent = 'Verifiey your email once!';
                                document.getElementById('errorverified2').style.color = 'red';
                            }
                        });
                }
            }
        });


        let btnotpId=document.getElementById('btnotp');
        let btnresendId=document.getElementById('btnresend');
        function fun(){

            // let url = 'http://localhost:8443/resendOtpAgain';
            // console.log('resend button');
            //     let option = {
            //         method: 'POST',
            //         headers: {
            //             'Content-Type':'application/json'
            //         },
            //         body: JSON.stringify({
            //             "id":(objresponse[0])
            //         })
            //     };
            //     console.log(objresponse);
            //     fetch(url, option)
            //         .then(function(response) {
            //             return response.json();
            //         })
            //         .then(function(jsonData) {
            //             if (jsonData) {
            //                 //console.log(jsonData)
            //               //  windows.href='http://127.0.0.1:5500/jwt_web/otp%20demo/Login2.html';
            //                 objresponse[0]=(jsonData);
            //                 //document.getElementById('success').textContent = 'Enter your OTP';
            //             }
            //         });
        }
        let count2=0;
        btnotpId.addEventListener('click',function(){
            if(count2==0){
                let otpId=document.getElementById('otp').value;
                console.log(objresponse[0]);
                console.log(otpId)
                if(otpId!==''){
                    console.log(objresponse[0]);
                    let url = 'https://localhost:8443/mail/OtpVerification';
                    //  let url = 'http://localhost:8443/OtpVerification';
                    console.log(objresponse[0]);
                    let option = {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            "id":(objresponse[0]),
                            "otp": otpId
                        })
                    };

                    fetch(url,option)

                        .then(function(response){
                            return response.text();
                        })
                        .then(function(jsonData){
                            console.log(jsonData==='ok')
                            if(jsonData==='ok'){
                                document.getElementById('Otp Verified successfully!')
                                count2+=1;
                                document.getElementById('movesignUp').classList.remove('d-none')
                                btnotpId.classList.add('d-none');
                                //window.location.hash='sectionSignUp';
                       //         document.getElementById('success').textContent = 'Now Register yourself';
                            }
                            else{
                                document.getElementById('otperror').textContent='Check your otp';
                                document.getElementById('otperror').style.color='red';
                            }
                        });
                }
            }
        });
        btnresendId.addEventListener('click',function(){
            // let url = 'http://localhost:8443/resendOtpAgain';
            let url = 'https://localhost:8443/mail/resendOtpAgain';

            console.log('resend button');
            let option = {
                method: 'POST',
                headers: {
                    'Content-Type':'application/json'
                },
                body: JSON.stringify({
                    "id":(objresponse[0])
                })
            };
            console.log(objresponse);
            fetch(url, option)
                .then(function(response) {
                    return response.json();
                })
                .then(function(jsonData) {
                    if (jsonData) {
                        //console.log(jsonData)
                        //  windows.href='http://127.0.0.1:5500/jwt_web/otp%20demo/Login2.html';
                        objresponse[0]=(jsonData);
                        //document.getElementById('success').textContent = 'Enter your OTP';
                    }
                });
        });

        //email otp forget password verification
        let btnotpId2=document.getElementById('btnotp2');
        let countotp=0;
        btnotpId2.addEventListener('click',async function(){
            if(countotp==0){
                let otpId=document.getElementById('otp2').value;
                console.log(otpId)
                if(otpId!==''){
                    console.log(objresponse[0]);
                    let url = 'https://localhost:8443/user/changePassword/verifyOtp/viaMail';
                    //  let url = 'http://localhost:8443/OtpVerification';
                    console.log(objresponse[0]);
                    let option = {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            "id":(objresponse[0]),
                            "otp": otpId
                        })
                    };

                    await fetch(url,option)

                      .then( function(response){
                             return response.text();
                        })
                        .then(function(jsonData){
                            console.log(jsonData);
                            if(jsonData==='ok'){
                                document.getElementById('btnNewPassword').classList.remove('d-none');
                                document.getElementById('otp2information').textContent='Otp Verfied successfully!!!';
                                btnotpId2.classList.add('d-none');
                                count2+=1;
                                //btnotpId.setAttribute('onclick',"display('sectionNewPassword')");
                                //window.location.hash='sectionSignUp';
                                //         document.getElementById('success').textContent = 'Now Register yourself';
                            }
                            else{
                                document.getElementById('otperror2').textContent='Check your otp';
                                document.getElementById('otperror2').style.color='red';
                            }
                        });
                }
            }
        });
        let countVariable=0;
        document.getElementById('passwordUpdatebtn').addEventListener('click',function(){
        if(countVariable===0) {
            if (document.getElementById('newPassword').value !== document.getElementById('conformPassword').value) {
                document.getElementById('errorMessagePasswordUPdate').textContent = 'both are should be same';
                document.getElementById('errorMessagePasswordUPdate').style.color = 'red';
            } else if ((document.getElementById('newPassword').value === '' )|| (document.getElementById('conformPassword').value === '')) {
                document.getElementById('errorMessagePasswordUPdate').textContent = 'Do not keep empty';
                document.getElementById('errorMessagePasswordUPdate').style.color = 'red';
            } else {

                let url = 'https://localhost:8443/user/changePassword/viaMail';
                document.getElementById('errorMessagePasswordUPdate').textContent ='';
                let option = {
                    method: 'POST',
                    headers: {
                        'Content-type': 'application/json'
                    },
                    body: JSON.stringify({
                        'mail': userEmailEnter,
                        'password': document.getElementById('newPassword').value
                    })
                };
                fetch(url, option)
                    .then(function (response) {
                        return response.text();
                    })
                    .then(function (jsonData) {

                        if (jsonData !== 'null') {
                            document.getElementById('movetologinagain').classList.remove('d-none');
                            document.getElementById('passwordUpdatebtn').classList.add('d-none');
                            document.getElementById('passwordchangeinformation').textContent='Your password is updated successfully!';
                            countVariable+=1;
                            console.log('sucessful completed');
                            document.getElementById('passwordUpdatebtn').setAttribute('onclick', "display('sectionSignIn')");
                        }
                    });
            }
        }
        })

        // upload image in registration
        // let imageUrl=null;
        // document.getElementById('imageUpload').addEventListener('change', function (event) {
        //     const file = event.target.files[0];
        //     if (typeof FileReader === 'function') {
        //         const reader = new FileReader()
        //         reader.onload = event => {
        //             window.CompressBase64.default(event.target.result, {
        //                 width: 100,
        //                 type: 'image/png',
        //                 max: 7, // max size
        //                 min: 5,
        //                 quality: 0.8,
        //             }).then(result => {
        //                 console.log(result.length);
        //                 console.log(result);
        //                 document.getElementById('uploadImage').src=`${result}`;
        //                 document.getElementById('userImageNew').src=`${result}`;
        //                 document.getElementById('userImageNav').src=`${result}`;
        //                 imageUrl=result;
        //                 //resolve(result)
        //             })
        //         }
        //         reader.readAsDataURL(file)
        //     } else {
        //         alert('Your browser does not support FileReader')
        //     }
        //     // Read the file as a binary string
        //     //reader.readAsBinaryString(file);
        // });

        //image 1.1 added
        let imageUrl = null;
        document.getElementById('imageUpload').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (typeof FileReader === 'function') {
                const reader = new FileReader();
                reader.onload = function(event) {
                    window.CompressBase64.default(event.target.result, {
                        width: 100,
                        type: 'image/png',
                        max: 7, // max size
                        min: 5,
                        quality: 0.8,
                    }).then(result => {
                        console.log(result.length);
                        console.log(result);
                        document.getElementById('uploadImage').src = `${result}`;
                        document.getElementById('userImageNew').src =`${result}`;
                        document.getElementById('userImageNav').src =`${result}`;
                        imageUrl = result;
                    }).catch(error => {
                        console.error('Compression error:', error);
                    });
                };
                reader.readAsDataURL(file);
            } else {
                alert('Your browser does not support FileReader');
            }
        });





        let nameId = document.getElementById('fullName');
        let emailId = document.getElementById('userName');
        let passwordId = document.getElementById('password11');
        let regiId = document.getElementById('regi');
        let logId = document.getElementById('log');
        let successregiId = document.getElementById('successregi');
        regiId.addEventListener('click', function() {
            let datapass=passwordId.value;
            console.log(datapass);
            let obj = {
                fullName: nameId.value,
                username: emailId.value,
                password: datapass,
                image:imageUrl
            };
            console.log(obj);
            //let url = "http://localhost:8443/toRegister";
            let url = "https://localhost:8443/user/toRegister";
            let option = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'

                },
                body: JSON.stringify(obj)
            };
            fetch(url, option)
                .then(function(response) {
                    return response.text();
                })
                .then(function(jsonData) {
                    if (jsonData!=="try again later") {
                        logId.classList.remove('d-none');
                        successregiId.textContent = 'you have successful registerd now go for login';
                        regiId.classList.add('d-none');
                    }
                }).catch((e) => {
                console.log(e);
            });
        });
        let array=[];
        let array2=[]; //data need to be added if any data is already presented in database
        let namelogId = document.getElementById('namelog');
        let passwordlogId = document.getElementById('passwordlog');
        let btnlogId = document.getElementById('btnlog');
        let count3=0;
        btnlogId.addEventListener('click', function() {
            if(namelogId.value==='' || passwordlogId.value===''){
                alert('fill all the details');
                document.getElementById('successLogin').textContent='';
                return false;
            }
            else {
                document.getElementById('successLogin').textcontent='';
                if (count3 === 0) {
                    let obj = {
                        user_name: namelogId.value,
                        password: passwordlogId.value
                    };
                    console.log(obj);
                    // let url = "http://localhost:8443/userLogin";
                    let url = "https://localhost:8443/user/userLogin";
                    let option = {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(obj)
                    };
                    fetch(url, option)
                        .then(function (response) {
                            return response.json();
                        })
                        .then(function (jsonData){
                            console.log(jsonData);
                            if (jsonData.token === '' || jsonData.fullName==='' || jsonData.image==='') {
                                document.getElementById('successLogin').textContent='Either username or password are wrong';
                                document.getElementById('successLogin').style.color='red';
                            }

                            else {
                                document.getElementById('successLogin').textcontent='';
                                btnlogId.classList.add('d-none');
                                document.getElementById('successLogin').textContent = 'Login successfully click Home button';
                                document.getElementById('successLogin').style.color='green';
                                document.getElementById('HomePagemove').classList.remove('d-none');
                                count3 += 1;
                                localStorage.setItem('jwttoken', jsonData.token);
                                console.log(jsonData.token + ' data stored');
                                document.getElementById('nameHome').textContent = jsonData.fullName;
                                document.getElementById('userNameNew').textContent = jsonData.fullName;
                                document.getElementById('userImageNew').src = `${jsonData.image}`;
                                document.getElementById('userImageNav').src = `${jsonData.image}`;
                                //btnlogId.setAttribute('onclick',"display('sectionHome')");
                                namelogId.textContent = '';
                                passwordlogId.textContent = '';
                                //window.location.hash='sectionHome'
                                console.log(jsonData);
                            }
                        }).catch((e) => {
                            console.log('catch',e);
                        document.getElementById('successLogin').textcontent='Either username or password are wrong';
                    });
                }
            }
        });
        let logoutId=document.getElementById('logout');
        logoutId.addEventListener('click',function(){
            localStorage.removeItem('jwttoken');
            if(localStorage.getItem('jwttoken')===null){
                console.log('token deleted');
                document.getElementById('namelog').value='';
                document.getElementById('passwordlog').value='';
                document.getElementById('successLogin').textContent='';
                btnlogId.classList.remove('d-none');
                document.getElementById('HomePagemove').classList.add('d-none');
                count3=0;
                //logoutId.setAttribute('onclick',"display('sectionSignIn')");
            }

        })
        // let btnId = document.getElementById('btn');
        // let listId=document.getElementById('list');
        // function fun2({data}){
        //     console.log(data);
        //     let id=data.id;
        //     let name=data.contactName;
        //     let mobilenumber=data.contactNumber;
        //     console.log(id,name,mobilenumber);
        //     let divId='div'+array.length;
        //     let div=document.createElement('div');
        //     div.id=divId;
        //     listId.appendChild(div);
        //     let label1=document.createElement('label');
        //     label1.textContent=name;
        //     label1.id='labelname'+array.length;
        //     div.appendChild(label1);
        //     let label2=document.createElement('label');
        //     label2.textContent=mobilenumber;
        //     label2.id='labelmobilenumber'+array.length;
        //     div.appendChild(label2);
        //     let savebtn=document.createElement('button');
        //     savebtn.id='save'+array.length;
        //     savebtn.textContent='Update Here';
        //     savebtn.classList.add('btn','btn-success');
        //     div.appendChild(savebtn);
        //     let deletebtn=document.createElement('button');
        //     deletebtn.id='delete'+array.length;
        //     deletebtn.textContent='❌';
        //     deletebtn.style.width="50px";
        //     div.appendChild(deletebtn);
        //     document.getElementById(savebtn.id).addEventListener('click',function(){
        //         let item=localStorage.getItem('jwttoken');
        //         let input=prompt('Enter your updated number');
        //         let inputname=prompt('Enter your updated name')
        //         let obj={
        //             id:id,
        //             contactName:inputname,
        //             contactNumber:parseInt(input)
        //         };
        //         console.log(obj);
        //         let url="http://localhost:8443/contact/updateContactNumber/";
        //         //  let url="http://localhost:8443/updateContactNumber";
        //         let option={
        //             method:'PUT',
        //             headers:{
        //                 'Content-Type':'application/json',
        //                 'Authorization': Bearer ${item}
        //             },
        //             body:JSON.stringify(obj)
        //         };
        //         fetch(url,option)
        //             .then(function(response){
        //                 return response.json();
        //             })
        //             .then(function(jsonData){
        //                 //console.log(jsonData);
        //                 if(input!==''){
        //                     label2.textContent=input;
        //                 }
        //                 if(inputname!==''){
        //                     label1.textContent=inputname
        //                 }
        //             }).catch((error)=>{
        //             console.log(error);
        //         });
        //     });
        //     document.getElementById(deletebtn.id).addEventListener('click',function(){
        //         console.log('delete1');
        //         console.log(id);
        //         let item2=localStorage.getItem('jwttoken');
        //         console.log(item2);
        //         let obj={
        //             id:id,
        //             contactName:name,
        //             contactNumber:parseInt(mobilenumber)
        //         };
        //         console.log(obj.id);
        //
        //         let url=http://localhost:8443/contact/deleteContact/;
        //         console.log(item2);
        //         //let url=http://localhost:8443/deleteContact/${id};
        //         let option={
        //             method:'DELETE',
        //             headers:{
        //                 'Content-Type':'application/json',
        //                 'Authorization': Bearer ${item2}
        //             },
        //             body:JSON.stringify(obj)
        //         };
        //         fetch(url,option)
        //             .then(function(response){
        //                 console.log(response)
        //                 return response.text();
        //             })
        //             .then(function(jsonData){
        //                 console.log(jsonData!=='null');
        //                 document.getElementById(divId).removeChild(label1);
        //                 document.getElementById(divId).removeChild(label2);
        //                 document.getElementById(divId).removeChild(savebtn);
        //                 document.getElementById(divId).removeChild(deletebtn);
        //             }).catch((error)=>{
        //             console.log(error);
        //         });
        //     });
        // }

        function addContactToTable(contact) {
            // Select the table body where new rows will be added
            let tableBody = document.querySelector('#contactTable tbody');

            // Create a new row element
            let newRow = document.createElement('tr');

            // Create cells for name, number, update, and delete buttons
            let nameCell = document.createElement('td');
            nameCell.textContent = contact.contactName;

            let numberCell = document.createElement('td');
            numberCell.textContent = contact.contactNumber;

            let updateCell = document.createElement('td');
            let updateBtn = document.createElement('button');
            updateBtn.textContent = 'Update Here';
            updateBtn.classList.add('btn', 'btn-success');
            updateBtn.addEventListener('click', function() {
                let newName = prompt('Enter updated name:');
                let newNumber = prompt('Enter updated number:');
                if (newName && newNumber) {
                    // Update the table cell contents
                    nameCell.textContent = newName;
                    numberCell.textContent = newNumber;

                    // Update the array (optional)
                    contact.contactName = newName;
                    contact.contactNumber = newNumber;
                    let obj={
                        id:id,
                        contactName:newName,
                        contactNumber:newNumber
                    };
                    let item=localStorage.getItem('jwttoken');
                    let url='https://localhost:8443/contact/updateContactNumber/';
                    let option={
                        method:'PUT',
                        headers:{
                            'Content-Type':'application/json',
                            'Authorization':`Bearer ${item}`
                        },
                        body:JSON.stringify(obj)
                    };
                    fetch(url,option)
                        .then(function(response){
                            return response.text();
                        })
                        .then(function(jsonData){
                            console.log('updated data',jsonData);
                            if(jsonData!=='null'){
                                document.getElementById('response').textContent='Data updated successfully';
                                document.getElementById('response').textContent='';
                            }
                        }).catch((error)=>{
                        console.log(error);
                    });
                }
            });
            updateCell.appendChild(updateBtn);

            let deleteCell = document.createElement('td');
            let deleteBtn = document.createElement('button');
            deleteBtn.textContent = '❌';
            deleteBtn.classList.add('btn', 'btn-danger');
            deleteBtn.addEventListener('click', function() {
                // Remove the row from the table
                let item1=localStorage.getItem('jwttoken');
                let obj={
                    id:id,
                    contactName:contact.name,
                    contactNumber:contact.number
                }
                let url='https://localhost:8443/contact/deleteContact/';
                let option={
                    method:'DELETE',
                    headers:{
                        'Content-Type':'application/json',
                        'Authorization': `Bearer ${item1}`
                    },
                    body:JSON.stringify(obj)
                };
                fetch(url,option)
                    .then(function(response){
                        return response.text();
                    })
                    .then(function(jsonData){
                        if(jsonData!=='null'){
                            tableBody.removeChild(newRow);
                        }
                        console.log(jsonData);

                    }).catch((error)=>{
                    console.log(error);
                });
                // Remove from the array (optional)
                let index = array.indexOf(contact);
                if (index !== -1) {
                    array.splice(index, 1);
                }
            });
            deleteCell.appendChild(deleteBtn);

            // Append cells to the row
            newRow.appendChild(nameCell);
            newRow.appendChild(numberCell);
            newRow.appendChild(updateCell);
            newRow.appendChild(deleteCell);

            // Append the row to the table body
            tableBody.appendChild(newRow);

            // Add contact to array (optional)
            // array.push(contact);

        }

        let count4=0;
        let contactPageRedirectId=document.getElementById('contactPageRedirect');
        contactPageRedirectId.addEventListener('click',function(){
            let item=localStorage.getItem('jwttoken');
            let url="https://localhost:8443/contact/getAllContacts";
            // let url="http://localhost:8443/getAllContacts";
            let option={
                method:'GET',
                headers:{
                    'Authorization': `Bearer ${item}`
                }
            };
            fetch(url,option)
                .then(function(response){
                    console.log(response);
                    return response.json();
                })
                .then(function(jsonData){
                    if(count4===0){
                        //document.getElementById('pressbelow').textContent='press contact button again';
                        count4+=1;
                        for(data of jsonData){
                            array.push({id:data.id,name:data.contactName,mobilenumber:data.contactNumber});
                            //console.log(data.id);
                            //console.log({data});
                            addContactToTable(data);
                        }
                        contactPageRedirectId.setAttribute('onclick',"display('sectionFormcontainer')");
                    }
                });
        });
        //let array = [];
        let id=null;
        // Function to add data dynamically to the contact table


        // Event listener for "Add Contact" button
        document.getElementById('btnAddContact').addEventListener('click', function() {
            // Prompt user for contact details
            let name = prompt('Enter contact name:');
            let number = prompt('Enter contact number:');
            let item=localStorage.getItem('jwttoken');
            if (name && number) {
                // Create a new contact object
                let newContact = {
                    contactName: name,
                    contactNumber: number
                };

                // Add contact to table
                console.log('adding contact',array);
                let url='https://localhost:8443/contact/addContact';
                let option={
                    method:'POST',
                    headers:{
                        'Content-Type':'application/json',
                        'Authorization':`Bearer ${item}`
                    },
                    body:JSON.stringify(newContact)
                };
                fetch(url,option)
                    .then(function(response){
                        return response.json();
                    })
                    .then(function(jsonData){
                        id=jsonData.id;
                        console.log('json parse data',jsonData);
                        addContactToTable(newContact);
                        document.getElementById('response').textContent='Your data added successful!';
                    }).catch((error)=>{
                    console.log(error);
                });
            }
        });
        // let btnId = document.getElementById('btn');
        // let listId=document.getElementById('list');


        // for(let obj of array2){
        //     array.push({id:obj.id,name:obj.contactName,mobilenumber:obj.contactNumber});
        //     console.log(array);
        //     fun2(obj.id,obj.name,obj.mobilenumber);
        // }
        // btnId.addEventListener('click', function() {
        //
        //     if (count1 === 0) {
        //         count1 += 1;
        //         let carId = document.getElementById('car');
        //         carId.classList.add('bg');
        //         let btnsave = document.createElement('button');
        //         btnsave.textContent = 'save Contact';
        //         btnsave.id='btnsaveId';
        //         carId.appendChild(btnsave);
        //
        //         let input1=document.createElement('input');
        //         input1.type='text';
        //         input1.id='uname';
        //         carId.appendChild(input1);
        //
        //         let input2=document.createElement('input');
        //         input2.type='text';
        //         input2.id='mobilenumber';
        //         carId.appendChild(input2);
        //
        //
        //
        //
        //         document.getElementById(btnsave.id).addEventListener('click', function() {
        //             let obj={
        //                 contactName:document.getElementById(input1.id).value,
        //                 contactNumber:parseInt(document.getElementById(input2.id).value)
        //             };
        //             array.push(obj);
        //             let item=localStorage.getItem('jwttoken');
        //             console.log(item);
        //             console.log(array);
        //             //  let url='http://localhost:8443/addContact';
        //             let url='http://localhost:8443/contact/addContact';
        //             let option={
        //                 method:'POST',
        //                 headers:{
        //                     'Content-Type':'application/json',
        //                     'Authorization':`Bearer ${item}`
        //                 },
        //                 body:JSON.stringify(obj)
        //             };
        //             fetch(url,option)
        //                 .then(function(response){
        //                     return response.json();
        //                 })
        //                 .then(function(jsonData){
        //                     console.log('json parse data',jsonData);
        //                     fun3({jsonData});
        //                 }).catch((error)=>{
        //                 console.log(error);
        //             });
        //             //fun2(obj.id,obj.contactName,obj.contactNumber);
        //             carId.removeChild(btnsave);
        //             carId.removeChild(input1);
        //             carId.removeChild(input2);
        //             carId.classList.remove('bg');
        //             count1 = 0;
        //         });
        //     }
        // });










    </script>
    <script type="text/javascript" src="https://d1tgh8fmlzexmh.cloudfront.net/ccbp-static-website/js/ccbp-ui-kit.js"></script>

</body>
</html>





















<!-- let fieldIndex = 1;
        let fieldsData = [];

        document.getElementById('add-field-button').addEventListener('click', function() {
            const formContainer = document.getElementById('sectionFormcontainer');
            const lastField = formContainer.lastElementChild.getElementsByClassName('field-input')[0];

            if (lastField.value.trim() !== "") {
                const newFieldContainer = document.createElement('div');
                newFieldContainer.className = 'field-container';
                newFieldContainer.setAttribute('data-index', fieldIndex);

                const newField = document.createElement('input');
                newField.type = 'text';
                newField.className = 'field-input form-control';
                newField.placeholder = 'Enter value';

                const updateButton = document.createElement('button');
                updateButton.className = 'btn btn-primary btn-update';
                updateButton.innerHTML = 'Update';
                updateButton.setAttribute('onclick',` updateField(${fieldIndex})`);

                const deleteButton = document.createElement('button');
                deleteButton.className = 'btn btn-danger btn-delete';
                deleteButton.innerHTML = 'Delete';
                deleteButton.setAttribute('onclick', deleteField(${fieldIndex}));

                newFieldContainer.appendChild(newField);
                newFieldContainer.appendChild(updateButton);
                newFieldContainer.appendChild(deleteButton);

                formContainer.appendChild(newFieldContainer);
                fieldIndex++;
            } else {
                alert('Please fill out the previous field before adding a new one.');
            }
        });

        document.getElementById('save-button').addEventListener('click', function() {
            const fieldInputs = document.getElementsByClassName('field-input');
            fieldsData = [];

            for (let input of fieldInputs) {
                if (input.value.trim() !== "") {
                    fieldsData.push(input.value.trim());
                }
            }


            const apiUrl = 'YOUR_API_ENDPOINT';

            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(fieldsData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                alert('Data saved successfully.');
            })
            .catch((error) => {
                console.error('Error:', error);
                alert('An error occurred while saving data.');
            });
        });

        function updateField(index) {
            const fieldContainer = document.querySelector(.field-container[data-index='${index}']);
            const fieldInput = fieldContainer.getElementsByClassName('field-input')[0];
            console.log(fieldInput.value);
            if (fieldInput.value.trim() !== "") {

                const apiUrl = "URL ";

                fetch(apiUrl, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ value: fieldInput.value.trim() })
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Update Success:', data);
                    alert('Field updated successfully.');
                })
                .catch((error) => {
                    console.error('Update Error:', error);
                    alert('An error occurred while updating the field.');
                });
            } else {
                alert('Please enter a value to update.');
            }
        }

        function deleteField(index) {
            const fieldContainer = document.querySelector(.field-container[data-index='${index}']);
            console.log(index);
            fieldContainer.remove();
            // const apiUrl = YOUR_API_DELETE_ENDPOINT/${index};

            // fetch(apiUrl, {
            //     method: 'DELETE'
            // })
            // .then(response => response.json())
            // .then(data => {
            //     console.log('Delete Success:', data);
            //     alert('Field deleted successfully.');
            //     fieldContainer.remove();
            // })
            // .catch((error) => {
            //     console.error('Delete Error:', error);
            //     alert('An error occurred while deleting the field.');
            // });
        } -->



















<!-- let fieldIndex = 1;
        let fieldsData = [];

        document.getElementById('add-field-button').addEventListener('click', function() {
            const formContainer = document.getElementById('sectionFormcontainer');
            const lastField = formContainer.lastElementChild.getElementsByClassName('field-input')[0];

            if (lastField.value.trim() !== "") {
                const newFieldContainer = document.createElement('div');
                newFieldContainer.className = 'field-container';
                newFieldContainer.setAttribute('data-index', fieldIndex);

                const newField = document.createElement('input');
                newField.type = 'text';
                newField.className = 'field-input form-control';
                newField.placeholder = 'Enter value';

                const updateButton = document.createElement('button');
                updateButton.className = 'btn btn-primary btn-update';
                updateButton.innerHTML = 'Update';
                updateButton.setAttribute('onclick',` updateField(${fieldIndex})`);

                const deleteButton = document.createElement('button');
                deleteButton.className = 'btn btn-danger btn-delete';
                deleteButton.innerHTML = 'Delete';
                deleteButton.setAttribute('onclick', deleteField(${fieldIndex}));

                newFieldContainer.appendChild(newField);
                newFieldContainer.appendChild(updateButton);
                newFieldContainer.appendChild(deleteButton);

                formContainer.appendChild(newFieldContainer);
                fieldIndex++;
            } else {
                alert('Please fill out the previous field before adding a new one.');
            }
        });

        document.getElementById('save-button').addEventListener('click', function() {
            const fieldInputs = document.getElementsByClassName('field-input');
            fieldsData = [];

            for (let input of fieldInputs) {
                if (input.value.trim() !== "") {
                    fieldsData.push(input.value.trim());
                }
            }


            const apiUrl = 'YOUR_API_ENDPOINT';

            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(fieldsData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                alert('Data saved successfully.');
            })
            .catch((error) => {
                console.error('Error:', error);
                alert('An error occurred while saving data.');
            });
        });

        function updateField(index) {
            const fieldContainer = document.querySelector(.field-container[data-index='${index}']);
            const fieldInput = fieldContainer.getElementsByClassName('field-input')[0];
            console.log(fieldInput.value);
            if (fieldInput.value.trim() !== "") {

                const apiUrl = "URL ";

                fetch(apiUrl, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ value: fieldInput.value.trim() })
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Update Success:', data);
                    alert('Field updated successfully.');
                })
                .catch((error) => {
                    console.error('Update Error:', error);
                    alert('An error occurred while updating the field.');
                });
            } else {
                alert('Please enter a value to update.');
            }
        }

        function deleteField(index) {
            const fieldContainer = document.querySelector(.field-container[data-index='${index}']);
            console.log(index);
            fieldContainer.remove();
            // const apiUrl = YOUR_API_DELETE_ENDPOINT/${index};

            // fetch(apiUrl, {
            //     method: 'DELETE'
            // })
            // .then(response => response.json())
            // .then(data => {
            //     console.log('Delete Success:', data);
            //     alert('Field deleted successfully.');
            //     fieldContainer.remove();
            // })
            // .catch((error) => {
            //     console.error('Delete Error:', error);
            //     alert('An error occurred while deleting the field.');
            // });
        } -->